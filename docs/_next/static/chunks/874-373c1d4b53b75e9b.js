"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[874],{5462:(e,t,n)=>{n.d(t,{h:()=>i});var r=n(1012),a=n(2115);function i(){let[e,t]=(0,a.useState)(void 0),[n,i]=(0,a.useState)(void 0),[o,s]=(0,a.useState)(void 0),[l,u]=(0,a.useState)(!1),[c,d]=(0,a.useState)("idle"),[y,p]=(0,a.useState)(void 0),[m,h]=(0,a.useState)(void 0),[b,g]=(0,a.useState)(void 0),w=(0,a.useRef)(()=>!1),f=(0,a.useRef)(()=>!1),v=(0,a.useRef)({31337:"http://localhost:8545"});(0,a.useEffect)(()=>{w.current=e=>e===n},[n]),(0,a.useEffect)(()=>{f.current=e=>e===m},[m]),(0,a.useEffect)(()=>{if(window.ethereum){let e=window.ethereum;t(e),e.request({method:"eth_accounts"}).then(t=>{t.length>0&&(s(t),u(!0),S(e),_(e))}).catch(e=>{console.error("Failed to get accounts:",e)});let n=t=>{s(t),u(t.length>0),t.length>0?_(e):(h(void 0),g(void 0))},r=t=>{i(parseInt(t,16)),l&&_(e)};return e.on("accountsChanged",n),e.on("chainChanged",r),()=>{e.removeListener("accountsChanged",n),e.removeListener("chainChanged",r)}}},[l]);let S=async e=>{try{let t=await e.request({method:"eth_chainId"});i(parseInt(t,16))}catch(e){console.error("Failed to get chain ID:",e)}},_=async e=>{try{let t=new r.k(e),n=await t.getSigner();h(n),g(t)}catch(e){console.error("Failed to setup providers:",e),p(e)}},T=(0,a.useCallback)(async()=>{if(!e){p(Error("MetaMask not detected")),d("error");return}try{d("connecting"),p(void 0);let t=await e.request({method:"eth_requestAccounts"});s(t),u(t.length>0),await S(e),await _(e),d("connected")}catch(e){console.error("Failed to connect:",e),p(e),d("error")}},[e]),K=(0,a.useCallback)(()=>{s(void 0),u(!1),h(void 0),g(void 0),d("idle"),p(void 0)},[]),D=(0,a.useCallback)(async t=>{if(e)try{await e.request({method:"wallet_switchEthereumChain",params:[{chainId:"0x".concat(t.toString(16))}]})}catch(n){if(4902===n.code&&31337===t)try{await e.request({method:"wallet_addEthereumChain",params:[{chainId:"0x7a69",chainName:"Hardhat Local",nativeCurrency:{name:"ETH",symbol:"ETH",decimals:18},rpcUrls:["http://localhost:8545"]}]})}catch(e){throw console.error("Failed to add chain:",e),e}else throw n}},[e]);return{provider:e,chainId:n,accounts:o,isConnected:l,status:c,error:y,ethersSigner:m,ethersReadonlyProvider:b,sameChain:w,sameSigner:f,initialMockChains:v.current,connect:T,disconnect:K,switchToChain:D}}},5749:(e,t,n)=>{let r;n.d(t,{w:()=>k});var a=n(2115),i=n(4827),o=n(6037);let s="https://cdn.zama.ai/relayer-sdk-js/0.2.0/relayer-sdk-js.umd.cjs";class l{isLoaded(){return c(window,this._trace)}load(){if(console.log("[RelayerSDKLoader] load..."),"relayerSDK"in window){if(!u(window.relayerSDK,this._trace))throw console.log("[RelayerSDKLoader] window.relayerSDK === undefined"),Error("RelayerSDKLoader: Unable to load FHEVM Relayer SDK");return Promise.resolve()}return new Promise((e,t)=>{if(document.querySelector('script[src="'.concat(s,'"]'))){c(window,this._trace)||t(Error("RelayerSDKLoader: window object does not contain a valid relayerSDK object.")),e();return}let n=document.createElement("script");n.src=s,n.type="text/javascript",n.async=!0,n.onload=()=>{c(window,this._trace)||(console.log("[RelayerSDKLoader] script onload FAILED..."),t(Error("RelayerSDKLoader: Relayer SDK script has been successfully loaded from ".concat(s,", however, the window.relayerSDK object is invalid.")))),e()},n.onerror=()=>{console.log("[RelayerSDKLoader] script onerror... "),t(Error("RelayerSDKLoader: Failed to load Relayer SDK from ".concat(s)))},console.log("[RelayerSDKLoader] add script to DOM..."),document.head.appendChild(n),console.log("[RelayerSDKLoader] script added!")})}constructor(e){this._trace=e.trace}}function u(e,t){return void 0===e?(null==t||t("RelayerSDKLoader: relayerSDK is undefined"),!1):null===e?(null==t||t("RelayerSDKLoader: relayerSDK is null"),!1):"object"!=typeof e?(null==t||t("RelayerSDKLoader: relayerSDK is not an object"),!1):d(e,"initSDK","function",t)?d(e,"createInstance","function",t)?d(e,"SepoliaConfig","object",t)?!("__initialized__"in e)||!0===e.__initialized__||!1===e.__initialized__||(null==t||t("RelayerSDKLoader: relayerSDK.__initialized__ is invalid"),!1):(null==t||t("RelayerSDKLoader: relayerSDK.SepoliaConfig is invalid"),!1):(null==t||t("RelayerSDKLoader: relayerSDK.createInstance is invalid"),!1):(null==t||t("RelayerSDKLoader: relayerSDK.initSDK is invalid"),!1)}function c(e,t){return void 0===e?(null==t||t("RelayerSDKLoader: window object is undefined"),!1):null===e?(null==t||t("RelayerSDKLoader: window object is null"),!1):"object"!=typeof e?(null==t||t("RelayerSDKLoader: window is not an object"),!1):"relayerSDK"in e?u(e.relayerSDK):(null==t||t("RelayerSDKLoader: window does not contain 'relayerSDK' property"),!1)}function d(e,t,n,r){if(!e||"object"!=typeof e)return!1;if(!(t in e))return null==r||r("RelayerSDKLoader: missing ".concat(String(t),".")),!1;let a=e[t];return null==a?(null==r||r("RelayerSDKLoader: ".concat(String(t)," is null or undefined.")),!1):typeof a===n||(null==r||r("RelayerSDKLoader: ".concat(String(t)," is not a ").concat(n,".")),!1)}var y=n(3899);async function p(){return r||(r=(0,y.P2)("fhevm",1,{upgrade(e){e.objectStoreNames.contains("paramsStore")||e.createObjectStore("paramsStore",{keyPath:"acl"}),e.objectStoreNames.contains("publicKeyStore")||e.createObjectStore("publicKeyStore",{keyPath:"acl"})}}))}function m(e){if("object"!=typeof e)throw Error("FhevmStoredPublicKey must be an object");if(null!==e){if(!("publicKeyId"in e))throw Error("FhevmStoredPublicKey.publicKeyId does not exist");if("string"!=typeof e.publicKeyId)throw Error("FhevmStoredPublicKey.publicKeyId must be a string");if(!("publicKey"in e))throw Error("FhevmStoredPublicKey.publicKey does not exist");if(!(e.publicKey instanceof Uint8Array))throw Error("FhevmStoredPublicKey.publicKey must be a Uint8Array")}}function h(e){if("object"!=typeof e)throw Error("FhevmStoredPublicParams must be an object");if(null!==e){if(!("publicParamsId"in e))throw Error("FhevmStoredPublicParams.publicParamsId does not exist");if("string"!=typeof e.publicParamsId)throw Error("FhevmStoredPublicParams.publicParamsId must be a string");if(!("publicParams"in e))throw Error("FhevmStoredPublicParams.publicParams does not exist");if(!(e.publicParams instanceof Uint8Array))throw Error("FhevmStoredPublicParams.publicParams must be a Uint8Array")}}async function b(e){let t,n=await p();if(!n)return{publicParams:null};let r=null;try{let t=await n.get("publicKeyStore",e);(null==t?void 0:t.value)&&(m(t.value),r=t.value)}catch(e){}let a=null;try{let t=await n.get("paramsStore",e);(null==t?void 0:t.value)&&(h(t.value),a=t.value)}catch(e){}let i=null==r?void 0:r.publicKey,o=null==r?void 0:r.publicKeyId,s=a?{2048:a}:null;return o&&i&&(t={id:o,data:i}),{...void 0!==t&&{publicKey:t},publicParams:s}}async function g(e,t,n){m(t),h(n);let r=await p();r&&(t&&await r.put("publicKeyStore",{acl:e,value:t}),n&&await r.put("paramsStore",{acl:e,value:n}))}class w extends Error{constructor(e,t,n){super(t,n),this.code=e,this.name="FhevmReactError"}}function f(e,t,n){throw new w(e,t,n?{cause:n}:void 0)}let v=async e=>{if(!c(window,console.log))throw Error("window.relayerSDK is not available");let t=await window.relayerSDK.initSDK(e);if(window.relayerSDK.__initialized__=t,!t)throw Error("window.relayerSDK.initSDK failed.");return!0};class S extends Error{constructor(e="FHEVM operation was cancelled"){super(e),this.name="FhevmAbortError"}}async function _(e){if("string"==typeof e){let t=new o.FR(e);return Number((await t.getNetwork()).chainId)}return Number.parseInt(await e.request({method:"eth_chainId"}),16)}async function T(e){let t=new o.FR(e);try{return await t.send("web3_clientVersion",[])}catch(t){f("WEB3_CLIENTVERSION_ERROR","The URL ".concat(e," is not a Web3 node or is not reachable. Please check the endpoint."),t)}finally{t.destroy()}}async function K(e){let t=await T(e);if("string"==typeof t&&t.toLowerCase().includes("hardhat"))try{let t=await D(e);if(!t||"object"!=typeof t||!("ACLAddress"in t&&"string"==typeof t.ACLAddress&&t.ACLAddress.startsWith("0x"))||!("InputVerifierAddress"in t&&"string"==typeof t.InputVerifierAddress&&t.InputVerifierAddress.startsWith("0x"))||!("KMSVerifierAddress"in t&&"string"==typeof t.KMSVerifierAddress&&t.KMSVerifierAddress.startsWith("0x")))return;return t}catch(e){return}}async function D(e){let t=new o.FR(e);try{return await t.send("fhevm_relayer_metadata",[])}catch(t){f("FHEVM_RELAYER_METADATA_ERROR","The URL ".concat(e," is not a FHEVM Hardhat node or is not reachable. Please check the endpoint."),t)}finally{t.destroy()}}async function I(e,t){let n=await _(e),r="string"==typeof e?e:void 0,a={31337:"http://localhost:8545",...null!=t?t:{}};return Object.hasOwn(a,n)?(r||(r=a[n]),{isMock:!0,chainId:n,rpcUrl:r}):{isMock:!1,chainId:n,rpcUrl:r}}let E=async e=>{let t=()=>{if(a.aborted)throw new S},r=e=>{o&&o(e)},{signal:a,onStatusChange:o,provider:s,mockChains:u}=e,{isMock:d,rpcUrl:y,chainId:p}=await I(s,u);if(d){let e=await K(y);if(e){r("creating");let a=await Promise.all([n.e(235),n.e(79)]).then(n.bind(n,7079)),i=await a.fhevmMockCreateInstance({rpcUrl:y,chainId:p,metadata:e});return t(),i}}t(),c(window,console.log)||(r("sdk-loading"),await new l({trace:console.log}).load(),t(),r("sdk-loaded")),c(window,console.log)&&!0===window.relayerSDK.__initialized__||(r("sdk-initializing"),await v(),t(),r("sdk-initialized"));let m=window.relayerSDK,h=m.SepoliaConfig.aclContractAddress;if(!function(e){return"string"==typeof e&&!!(0,i.PW)(e)}(h))throw Error("Invalid address: ".concat(h));let w=await b(h);t();let f={...m.SepoliaConfig,network:s,publicKey:w.publicKey,publicParams:w.publicParams};r("creating");let _=await m.createInstance(f);return await g(h,_.getPublicKey(),_.getPublicParams(2048)),t(),_};function R(e,t){if(!e){let e=t?"Assertion failed: ".concat(t):"Assertion failed.";throw console.error(e),Error(e)}}function k(e){let{provider:t,chainId:n,initialMockChains:r,enabled:i=!0}=e,[o,s]=(0,a.useState)(void 0),[l,u]=(0,a.useState)("idle"),[c,d]=(0,a.useState)(void 0),[y,p]=(0,a.useState)(i),[m,h]=(0,a.useState)(0),b=(0,a.useRef)(null),g=(0,a.useRef)(t),w=(0,a.useRef)(n),f=(0,a.useRef)(r),v=(0,a.useCallback)(()=>{b.current&&(g.current=void 0,w.current=void 0,b.current.abort(),b.current=null),g.current=t,w.current=n,s(void 0),d(void 0),u("idle"),void 0!==t&&h(e=>e+1)},[t,n]);return(0,a.useEffect)(()=>{v()},[v]),(0,a.useEffect)(()=>{p(i)},[i]),(0,a.useEffect)(()=>{if(!1===y){console.log("cancelled"),b.current&&(b.current.abort(),b.current=null),s(void 0),d(void 0),u("idle");return}if(!0===y){if(void 0===g.current){s(void 0),d(void 0),u("idle");return}b.current||(b.current=new AbortController),R(!b.current.signal.aborted,"!controllerRef.current.signal.aborted"),u("loading"),d(void 0);let e=b.current.signal,t=g.current;E({signal:e,provider:t,mockChains:f.current,onStatusChange:e=>console.log("[useFhevm] createFhevmInstance status changed: ".concat(e))}).then(n=>{console.log("[useFhevm] createFhevmInstance created!"),e.aborted||(R(t===g.current,"thisProvider === _providerRef.current"),s(n),d(void 0),u("ready"))}).catch(n=>{console.log("Error Was thrown !!! error... "+n.name),e.aborted||(R(t===g.current,"thisProvider === _providerRef.current"),s(void 0),d(n),u("error"))})}},[y,m]),{instance:o,refresh:v,error:c,status:l}}},6916:(e,t,n)=>{n.d(t,{p:()=>a});var r=n(2115);function a(){let[e]=(0,r.useState)(new Map);return{storage:{getItem:(0,r.useCallback)(async t=>e.get(t)||null,[e]),setItem:(0,r.useCallback)(async(t,n)=>{e.set(t,n)},[e]),removeItem:(0,r.useCallback)(async t=>{e.delete(t)},[e])}}}},9959:(e,t,n)=>{n.d(t,{K:()=>k});var r=n(2127),a=n(3338),i=n(9353),o=n(2115),s=n(7325),l=n(5777),u=n(5378),c=n(4827),d=n(2507);function y(){return Math.floor(Date.now()/1e3)}var p=new WeakMap,m=new WeakMap,h=new WeakMap,b=new WeakMap;class g{get contractAddresses(){return(0,s._)(this,p)}get userAddress(){return(0,s._)(this,m)}get publicKey(){return(0,s._)(this,h)}get key(){return(0,s._)(this,b)}constructor(e,t,n,a){if((0,l._)(this,p,{writable:!0,value:void 0}),(0,l._)(this,m,{writable:!0,value:void 0}),(0,l._)(this,h,{writable:!0,value:void 0}),(0,l._)(this,b,{writable:!0,value:void 0}),!c.PW(n))throw TypeError("Invalid address ".concat(n));let i=t.sort(),o=e.createEIP712(null!=a?a:r.j,i,0,0);try{let e=d.z.hash(o.domain,{UserDecryptRequestVerification:o.types.UserDecryptRequestVerification},o.message);(0,u._)(this,p,i),(0,u._)(this,m,n),(0,u._)(this,b,"".concat(n,":").concat(e))}catch(e){throw console.log(e),e}}}var w=new WeakMap,f=new WeakMap,v=new WeakMap,S=new WeakMap,_=new WeakMap,T=new WeakMap,K=new WeakMap,D=new WeakMap;class I{get privateKey(){return(0,s._)(this,f)}get publicKey(){return(0,s._)(this,w)}get signature(){return(0,s._)(this,v)}get contractAddresses(){return(0,s._)(this,K)}get startTimestamp(){return(0,s._)(this,S)}get durationDays(){return(0,s._)(this,_)}get userAddress(){return(0,s._)(this,T)}static checkIs(e){if(!e||"object"!=typeof e||!("publicKey"in e&&"string"==typeof e.publicKey)||!("privateKey"in e&&"string"==typeof e.privateKey)||!("signature"in e&&"string"==typeof e.signature)||!("startTimestamp"in e&&"number"==typeof e.startTimestamp)||!("durationDays"in e&&"number"==typeof e.durationDays)||!("contractAddresses"in e&&Array.isArray(e.contractAddresses)))return!1;for(let t=0;t<e.contractAddresses.length;++t)if("string"!=typeof e.contractAddresses[t]||!e.contractAddresses[t].startsWith("0x"))return!1;return!!("userAddress"in e&&"string"==typeof e.userAddress&&e.userAddress.startsWith("0x"))&&!!("eip712"in e&&"object"==typeof e.eip712&&null!==e.eip712)&&!!("domain"in e.eip712&&"object"==typeof e.eip712.domain)&&!!("primaryType"in e.eip712&&"string"==typeof e.eip712.primaryType)&&"message"in e.eip712&&!!("types"in e.eip712&&"object"==typeof e.eip712.types&&null!==e.eip712.types)}toJSON(){return{publicKey:(0,s._)(this,w),privateKey:(0,s._)(this,f),signature:(0,s._)(this,v),startTimestamp:(0,s._)(this,S),durationDays:(0,s._)(this,_),userAddress:(0,s._)(this,T),contractAddresses:(0,s._)(this,K),eip712:(0,s._)(this,D)}}static fromJSON(e){return new I("string"==typeof e?JSON.parse(e):e)}equals(e){return e.signature===(0,s._)(this,v)}isValid(){return y()<(0,s._)(this,S)+24*(0,s._)(this,_)*3600}async saveToGenericStringStorage(e,t,n){try{let r=JSON.stringify(this),a=new g(t,(0,s._)(this,K),(0,s._)(this,T),n?(0,s._)(this,w):void 0);await e.setItem(a.key,r),console.log("signature saved! contracts=".concat((0,s._)(this,K).length))}catch(e){console.error("FhevmDecryptionSignature.saveToGenericStringStorage() failed!")}}static async loadFromGenericStringStorage(e,t,n,r,a){try{let i=new g(t,n,r,a),o=await e.getItem(i.key);if(!o)return console.warn("Could not load signature! key=".concat(i.key)),null;try{let e=I.fromJSON(o);if(!e.isValid())return null;return e}catch(e){return null}}catch(e){return console.error("FhevmDecryptionSignature.loadFromGenericStringStorage() failed!"),null}}static async new(e,t,n,r,a){try{let i=await a.getAddress(),o=y(),s=e.createEIP712(n,t,o,365),l=await a.signTypedData(s.domain,{UserDecryptRequestVerification:s.types.UserDecryptRequestVerification},s.message);return new I({publicKey:n,privateKey:r,contractAddresses:t,startTimestamp:o,durationDays:365,signature:l,eip712:s,userAddress:i})}catch(e){return null}}static async loadOrSign(e,t,n,r,a){let i=await n.getAddress(),o=await I.loadFromGenericStringStorage(r,e,t,i,null==a?void 0:a.publicKey);if(o)return o;let{publicKey:s,privateKey:l}=null!=a?a:e.generateKeypair(),u=await I.new(e,t,s,l,n);return u?(await u.saveToGenericStringStorage(r,e,!!(null==a?void 0:a.publicKey)),u):null}constructor(e){if((0,l._)(this,w,{writable:!0,value:void 0}),(0,l._)(this,f,{writable:!0,value:void 0}),(0,l._)(this,v,{writable:!0,value:void 0}),(0,l._)(this,S,{writable:!0,value:void 0}),(0,l._)(this,_,{writable:!0,value:void 0}),(0,l._)(this,T,{writable:!0,value:void 0}),(0,l._)(this,K,{writable:!0,value:void 0}),(0,l._)(this,D,{writable:!0,value:void 0}),!I.checkIs(e))throw TypeError("Invalid FhevmDecryptionSignatureType");(0,u._)(this,w,e.publicKey),(0,u._)(this,f,e.privateKey),(0,u._)(this,v,e.signature),(0,u._)(this,S,e.startTimestamp),(0,u._)(this,_,e.durationDays),(0,u._)(this,T,e.userAddress),(0,u._)(this,K,e.contractAddresses),(0,u._)(this,D,e.eip712)}}let E={abi:[{inputs:[],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint256",name:"votingId",type:"uint256"},{indexed:!0,internalType:"address",name:"voter",type:"address"}],name:"VoteCast",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint256",name:"votingId",type:"uint256"},{indexed:!1,internalType:"string",name:"title",type:"string"},{indexed:!0,internalType:"address",name:"creator",type:"address"}],name:"VotingCreated",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint256",name:"votingId",type:"uint256"}],name:"VotingEnded",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint256",name:"votingId",type:"uint256"},{indexed:!1,internalType:"uint256[]",name:"results",type:"uint256[]"}],name:"VotingResultsRevealed",type:"event"},{inputs:[{internalType:"uint256",name:"_votingId",type:"uint256"},{internalType:"address[]",name:"_addresses",type:"address[]"}],name:"addToWhitelist",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"}],name:"admins",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"_votingId",type:"uint256"},{internalType:"address",name:"_voter",type:"address"}],name:"canVoteInVoting",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"string",name:"_title",type:"string"},{internalType:"string",name:"_description",type:"string"},{internalType:"string[]",name:"_options",type:"string[]"},{internalType:"uint256",name:"_startTime",type:"uint256"},{internalType:"uint256",name:"_endTime",type:"uint256"},{internalType:"bool",name:"_isPublic",type:"bool"}],name:"createVoting",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"_votingId",type:"uint256"}],name:"endVoting",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"_votingId",type:"uint256"},{internalType:"uint256",name:"_optionIndex",type:"uint256"}],name:"getEncryptedVoteCount",outputs:[{internalType:"euint32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"getTotalVotings",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"_votingId",type:"uint256"}],name:"getVotingInfo",outputs:[{internalType:"string",name:"title",type:"string"},{internalType:"string",name:"description",type:"string"},{internalType:"string[]",name:"options",type:"string[]"},{internalType:"address",name:"creator",type:"address"},{internalType:"uint256",name:"startTime",type:"uint256"},{internalType:"uint256",name:"endTime",type:"uint256"},{internalType:"bool",name:"isActive",type:"bool"},{internalType:"bool",name:"isPublic",type:"bool"},{internalType:"uint256",name:"totalVotes",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"_votingId",type:"uint256"},{internalType:"address",name:"_voter",type:"address"}],name:"hasVoted",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"_votingId",type:"uint256"}],name:"makeResultsPublic",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"owner",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"protocolId",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"uint256",name:"_votingId",type:"uint256"},{internalType:"address[]",name:"_addresses",type:"address[]"}],name:"removeFromWhitelist",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_admin",type:"address"},{internalType:"bool",name:"_isAdmin",type:"bool"}],name:"setAdmin",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"_votingId",type:"uint256"},{internalType:"externalEuint8",name:"_encryptedOption",type:"bytes32"},{internalType:"bytes",name:"_inputProof",type:"bytes"}],name:"vote",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"votingCounter",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"}],name:"votings",outputs:[{internalType:"string",name:"title",type:"string"},{internalType:"string",name:"description",type:"string"},{internalType:"address",name:"creator",type:"address"},{internalType:"uint256",name:"startTime",type:"uint256"},{internalType:"uint256",name:"endTime",type:"uint256"},{internalType:"bool",name:"isActive",type:"bool"},{internalType:"bool",name:"isPublic",type:"bool"},{internalType:"uint256",name:"totalVotes",type:"uint256"}],stateMutability:"view",type:"function"}]},R={31337:{address:"0x34248A778Af91b582Dc4E9906a38B9F1dF6cd7AB",chainId:31337,chainName:"localhost"},0xaa36a7:{address:"0xDa32e98576254785c9DcacCC89337DDb20D6Fdf5",chainId:0xaa36a7,chainName:"sepolia"}};function k(e){let{instance:t,fhevmDecryptionSignatureStorage:n,chainId:s,ethersSigner:l,ethersReadonlyProvider:u,sameChain:c,sameSigner:d}=e,[y,p]=(0,o.useState)([]),[m,h]=(0,o.useState)(!1),[b,g]=(0,o.useState)(!1),[w,f]=(0,o.useState)(!1),[v,S]=(0,o.useState)(""),[_,T]=(0,o.useState)(new Map),K=(0,o.useRef)(void 0),D=(0,o.useRef)(!1),k=(0,o.useRef)(!1),A=(0,o.useRef)(!1),M=(0,o.useMemo)(()=>{let e=function(e){var t;if(!e)return{abi:E.abi};let n=R[e.toString()];return n&&n.address&&n.address!==r.j?{address:n.address,chainId:null!=(t=n.chainId)?t:e,chainName:n.chainName,abi:E.abi}:{abi:E.abi,chainId:e}}(s);return K.current=e,e},[s]),P=(0,o.useMemo)(()=>M.address,[M.address]),F=(0,o.useMemo)(()=>M.abi,[M.abi]),C=(0,o.useMemo)(()=>!!P&&P!==r.j,[P]),V=(0,o.useMemo)(()=>P&&u&&!m,[P,u,m]),L=(0,o.useMemo)(()=>P&&u,[P,u]),j=(0,o.useCallback)(async()=>{if(!D.current&&P&&u){D.current=!0,h(!0),S("Loading votings...");try{let e=new a.NZ(P,F,u),t=await e.getTotalVotings(),n=[];for(let r=0;r<t;r++)n.push(e.getVotingInfo(r).then(e=>({id:r,title:e.title,description:e.description,options:e.options,creator:e.creator,startTime:Number(e.startTime),endTime:Number(e.endTime),isActive:e.isActive,isPublic:e.isPublic,totalVotes:Number(e.totalVotes)})));let r=await Promise.all(n);p(r),S("Loaded ".concat(r.length," votings"))}catch(e){console.error("Failed to load votings:",e),S("Failed to load votings")}finally{D.current=!1,h(!1)}}},[P,F,u]),N=(0,o.useCallback)(async(e,t,n,r,i,o)=>{if(!k.current&&l&&P){k.current=!0,g(!0),S("Creating voting...");try{let s=new a.NZ(P,F,l),u=await s.createVoting(e,t,n,r,i,o);S("Transaction submitted: ".concat(u.hash));let c=await u.wait();return S("Voting created successfully!"),setTimeout(()=>j(),1e3),c}catch(e){throw console.error("Failed to create voting:",e),S("Failed to create voting"),e}finally{k.current=!1,g(!1)}}},[l,P,F]),x=(0,o.useCallback)(async(e,n)=>{if(!A.current&&t&&l&&P){A.current=!0,f(!0),S("Preparing encrypted vote...");try{let r=t.createEncryptedInput(P,l.address);r.add8(n),S("Encrypting vote...");let i=await r.encrypt();S("Submitting vote...");let o=new a.NZ(P,F,l),s=await o.vote(e,i.handles[0],i.inputProof);S("Transaction submitted: ".concat(s.hash));let u=await s.wait();return S("Vote cast successfully!"),setTimeout(()=>j(),1e3),u}catch(e){throw console.error("Failed to cast vote:",e),S("Failed to cast vote"),e}finally{A.current=!1,f(!1)}}},[t,l,P,F]),W=(0,o.useCallback)(async e=>{if(l&&P)try{S("Ending voting...");let t=new a.NZ(P,F,l),n=await t.endVoting(e);S("Transaction submitted: ".concat(n.hash));let r=await n.wait();return S("Voting ended successfully!"),setTimeout(()=>j(),1e3),r}catch(e){throw console.error("Failed to end voting:",e),S("Failed to end voting"),e}},[l,P,F]),O=(0,o.useCallback)(async e=>{if(t&&l&&P)try{let r=new a.NZ(P,F,l),o=await r.getVotingInfo(e);if(o.creator.toLowerCase()!==l.address.toLowerCase()){S("Making results public...");let t=await r.makeResultsPublic(e);S("Transaction submitted: ".concat(t.hash)),await t.wait()}S("Preparing decryption...");let s=o.options.length,u=await I.loadOrSign(t,[P],l,n);if(!u)return void S("Unable to build FHEVM decryption signature");S("Decrypting results...");let c=[];for(let n=0;n<s;n++){let a=await r.getEncryptedVoteCount(e,n);a!==i.p?c.push(t.userDecrypt([{handle:a,contractAddress:P}],u.privateKey,u.publicKey,u.signature,u.contractAddresses,u.userAddress,u.startTimestamp,u.durationDays).then(e=>Number(e[a]))):c.push(Promise.resolve(0))}let d=await Promise.all(c),y=d.reduce((e,t)=>e+t,0),p={votingId:e,results:d,totalVotes:y};return T(t=>new Map(t.set(e,p))),S("Results decrypted successfully!"),p}catch(e){throw console.error("Failed to decrypt results:",e),S("Failed to decrypt results: "+e.message),e}},[t,l,P,F,n]),q=(0,o.useCallback)(async(e,t)=>{if(!V)return!1;try{let n=new a.NZ(P,F,u);return await n.hasVoted(e,t)}catch(e){return console.error("Failed to check voting status:",e),!1}},[V,P,F,u]),U=(0,o.useCallback)(async(e,t)=>{if(!V)return!1;try{let n=new a.NZ(P,F,u);return await n.canVoteInVoting(e,t)}catch(e){return console.error("Failed to check voting eligibility:",e),!1}},[V,P,F,u]),z=(0,o.useCallback)(e=>{let t=Math.floor(Date.now()/1e3);return e.isActive?t<e.startTime?"upcoming":t>e.endTime?"ended":"active":"ended"},[]);return(0,o.useEffect)(()=>{L&&j()},[L,j]),{contractAddress:P,isDeployed:C,canInteract:V,votings:y,votingResults:_,isLoading:m,isCreating:b,isVoting:w,message:v,refreshVotings:j,createVoting:N,castVote:x,endVoting:W,decryptVotingResults:O,hasVoted:q,canVote:U,getVotingStatus:z}}}}]);